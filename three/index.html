<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>My first three.js app</title>
    <style>
        body {
            margin: 0;
        }
    </style>
</head>
<body>
<script type="module">
    import {
        Scene,
        WebGLRenderer,
        PerspectiveCamera,
        AxesHelper,
        AmbientLight,
        GridHelper,
        MathUtils,
    } from './js/three.module.js'
    import {OBJLoader} from './js/objloader.module.js'
    import {MtlLoader} from './js/mtlloader.module.js'
    import {OrbitControls} from "./js/orbitcontrols.module.js";
    import Stats from "./js/stats.module.js";

    const objURL = 'https://core-ruangguru.s3.ap-southeast-1.amazonaws.com/3dobject/model.obj'
    const mtlURL = 'https://core-ruangguru.s3.ap-southeast-1.amazonaws.com/3dobject/model.mtl'

    const scene = new Scene()

    // const light = new PointLight(0xffffff, 2, 60);
    // light.position.set(10, 10, 10);
    // light.scale.set(1, 1, 1)
    // scene.add(light);

    // const light = new SpotLight()
    const light = new AmbientLight()
    scene.add(light)

    const camera = new PerspectiveCamera(45,
        window.innerWidth / window.innerHeight,
        0.1,
        1000
    )
    camera.position.set(6, 8, 14);

    const renderer = new WebGLRenderer({
        antiAlias: true
    })
    renderer.setSize(window.innerWidth, window.innerHeight)
    renderer.setClearColor(0xFEFEFE)
    document.body.appendChild(renderer.domElement)

    const controls = new OrbitControls(camera, renderer.domElement)

    const gridHelper = new GridHelper(12, 12);
    scene.add(gridHelper);

    const axesHelper = new AxesHelper(10);
    scene.add(axesHelper);

    const mtlLoader = new MtlLoader()
    mtlLoader.load(
        mtlURL,
        (materials) => {
            materials.preload()
            console.log(materials)
            const objLoader = new OBJLoader()
            objLoader.setMaterials(materials)
            objLoader.load(
                objURL,
                (object) => {
                    object.position.y = 2
                    object.rotateX(MathUtils.degToRad(-90));
                    object.rotateY(MathUtils.degToRad(0));
                    object.rotateZ(MathUtils.degToRad(0));
                    scene.add(object)
                },
                (xhr) => {
                    console.log((xhr.loaded / xhr.total) * 100 + '% loaded')
                },
                (error) => {
                    console.log('An error happened')
                }
            )
        },
        (xhr) => console.log((xhr.loaded / xhr.total) * 100 + '% loaded'),
        (error) => console.log(error)
    )


    window.addEventListener('resize', onWindowResize, false)

    function onWindowResize() {
        camera.aspect = window.innerWidth / window.innerHeight
        camera.updateProjectionMatrix()
        renderer.setSize(window.innerWidth, window.innerHeight)
        render()
    }

    const stats = Stats()
    document.body.appendChild(stats.dom)

    function render() {
        renderer.render(scene, camera)
    }

    function animate() {
        requestAnimationFrame(animate)
        controls.update()
        render()
        stats.update()
    }

    animate()

</script>
</body>
</html>